#include <stdlib.h>
#include <stdio.h>

#include "rift.h"

static rift_led test_leds[] = {
  { .pos = {{62654.000000,-32369.000000,67489.000000}}, .dir={{0.181956,-0.102972,0.977900}}, .pattern=0x1 },
  { .pos = {{77223.000000,461.000000,65695.000000}}, .dir={{0.299055,0.001984,0.954234}}, .pattern=0x6 },
  { .pos = {{28810.000000,-18973.000000,73225.000000}}, .dir={{0.082983,-0.096960,0.991823}}, .pattern=0x1a },
  { .pos = {{-84.000000,-32855.000000,72204.000000}}, .dir={{0.000000,-0.188028,0.982164}}, .pattern=0x1d },
  { .pos = {{-29034.000000,-18976.000000,73084.000000}}, .dir={{-0.082983,-0.096960,0.991823}}, .pattern=0x28 },
  { .pos = {{-63028.000000,-32148.000000,67397.000000}}, .dir={{-0.181956,-0.102972,0.977900}}, .pattern=0x2f },
  { .pos = {{-77294.000000,854.000000,65431.000000}}, .dir={{-0.299055,0.001984,0.954234}}, .pattern=0x33 },
  { .pos = {{-54350.000000,34509.000000,68657.000000}}, .dir={{-0.140969,0.134957,0.980772}}, .pattern=0x4b },
  { .pos = {{-20134.000000,18154.000000,74056.000000}}, .dir={{-0.056979,0.095951,0.993754}}, .pattern=0x4c },
  { .pos = {{54622.000000,34265.000000,68937.000000}}, .dir={{0.140969,0.134957,0.980772}}, .pattern=0x57 },
  { .pos = {{20263.000000,18178.000000,74162.000000}}, .dir={{0.056979,0.095951,0.993754}}, .pattern=0x62 },
  { .pos = {{-79039.000000,-12212.000000,28231.000000}}, .dir={{-0.993057,-0.099980,-0.061984}}, .pattern=0x65 },
  { .pos = {{-77552.000000,-12192.000000,-8267.000000}}, .dir={{-0.981566,-0.188915,-0.028963}}, .pattern=0x79 },
  { .pos = {{-70753.000000,-31449.000000,10335.000000}}, .dir={{-0.734056,-0.668042,-0.121987}}, .pattern=0x7e },
  { .pos = {{-58842.000000,-40811.000000,36299.000000}}, .dir={{-0.153997,-0.983099,-0.099003}}, .pattern=0x90 },
  { .pos = {{58971.000000,-40839.000000,36300.000000}}, .dir={{0.153997,-0.983099,-0.099003}}, .pattern=0xa4 },
  { .pos = {{28410.000000,-43608.000000,61449.000000}}, .dir={{-0.004975,-0.998636,-0.051974}}, .pattern=0x114 },
  { .pos = {{-80491.000000,-24821.000000,53426.000000}}, .dir={{-0.947594,-0.225904,-0.225904}}, .pattern=0x151 },
  { .pos = {{-27805.000000,-43501.000000,61546.000000}}, .dir={{0.004975,-0.998636,-0.051974}}, .pattern=0x183 },
  { .pos = {{70860.000000,-31459.000000,10270.000000}}, .dir={{0.734056,-0.668042,-0.121987}}, .pattern=0x18c },
  { .pos = {{77793.000000,-12100.000000,-8406.000000}}, .dir={{0.981566,-0.188915,-0.028963}}, .pattern=0x199 },
  { .pos = {{79193.000000,-12109.000000,28388.000000}}, .dir={{0.993057,-0.099980,-0.061984}}, .pattern=0x1aa },
  { .pos = {{80545.000000,-24740.000000,53463.000000}}, .dir={{0.947594,-0.225904,-0.225904}}, .pattern=0x1b5 },
  { .pos = {{-29035.000000,43600.000000,57635.000000}}, .dir={{-0.004975,0.999980,0.003998}}, .pattern=0x1c0 },
  { .pos = {{-78208.000000,29387.000000,53097.000000}}, .dir={{-0.871752,0.428856,-0.236921}}, .pattern=0x1cf },
  { .pos = {{72246.000000,30713.000000,149.000000}}, .dir={{0.816019,0.577024,-0.033998}}, .pattern=0x1d6 },
  { .pos = {{66819.000000,37673.000000,29726.000000}}, .dir={{0.526908,0.847875,-0.058962}}, .pattern=0x1e9 },
  { .pos = {{78039.000000,29271.000000,52974.000000}}, .dir={{0.871752,0.428856,-0.236921}}, .pattern=0x1f3 },
  { .pos = {{28870.000000,43476.000000,57414.000000}}, .dir={{0.004975,0.999980,0.003998}}, .pattern=0x1fc },
  { .pos = {{-67056.000000,37691.000000,29976.000000}}, .dir={{-0.526908,0.847875,-0.058962}}, .pattern=0x230 },
  { .pos = {{-72214.000000,30481.000000,328.000000}}, .dir={{-0.816019,0.577024,-0.033998}}, .pattern=0x252 },
  { .pos = {{-41308.000000,43391.000000,23572.000000}}, .dir={{-0.041995,0.999110,-0.003998}}, .pattern=0x282 },
  { .pos = {{-114.000000,43867.000000,33431.000000}}, .dir={{0.005982,0.999932,0.009980}}, .pattern=0x285 },
  { .pos = {{41024.000000,43188.000000,23313.000000}}, .dir={{0.041995,0.999110,-0.003998}}, .pattern=0x29b },
  { .pos = {{-11696.000000,25806.000000,-164146.000000}}, .dir={{-0.208077,0.144049,-0.967447}}, .pattern=0x29c },
  { .pos = {{-24016.000000,7052.000000,-160954.000000}}, .dir={{-0.421008,-0.007996,-0.907022}}, .pattern=0x2ae },
  { .pos = {{-32898.000000,-11805.000000,-153813.000000}}, .dir={{-0.493130,-0.214031,-0.843216}}, .pattern=0x2b7 },
  { .pos = {{-40291.000000,-31381.000000,-139963.000000}}, .dir={{-0.505856,-0.473871,-0.720802}}, .pattern=0x2c8 },
  { .pos = {{-15050.000000,-42141.000000,-143041.000000}}, .dir={{-0.147928,-0.689771,-0.708754}}, .pattern=0x2d1 },
  { .pos = {{14955.000000,-42260.000000,-142818.000000}}, .dir={{0.147928,-0.689771,-0.708754}}, .pattern=0x2e3 },
  { .pos = {{40052.000000,-31248.000000,-139999.000000}}, .dir={{0.505856,-0.473871,-0.720802}}, .pattern=0x2ed },
  { .pos = {{32807.000000,-11606.000000,-154013.000000}}, .dir={{0.493130,-0.214031,-0.843216}}, .pattern=0x2fa },
  { .pos = {{24133.000000,7293.000000,-161127.000000}}, .dir={{0.421008,-0.007996,-0.907022}}, .pattern=0x307 },
  { .pos = {{12004.000000,26290.000000,-164121.000000}}, .dir={{0.208077,0.144049,-0.967447}}, .pattern=0x309 },
};

void
rift_leds_init (rift_leds *leds, uint8_t num_points)
{
	(void)(num_points);
        leds->points = test_leds; //calloc(num_points, sizeof(rift_led));
        leds->num_points = sizeof (test_leds) / sizeof (test_leds[0]);
}

void
rift_leds_dump (rift_leds *leds, const char *desc)
{
        int i;
        printf ("LED model: %s\n", desc);
        for (i = 0; i < leds->num_points; i++) {
                rift_led *p = leds->points + i;
                printf ("%f;%f;%f;%f;%f;%f;255;255;0;1.0\n",
                    p->pos.x, p->pos.y, p->pos.z,
                    p->dir.x, p->dir.y, p->dir.z);
        }
}

void
rift_leds_clear (rift_leds *leds)
{
        //free (leds->points);
        leds->points = NULL;
}

/* Dummy OpenHMD functions */
void* ohmd_allocfn(ohmd_context* ctx, const char* e_msg, size_t size)
{
    (void)(ctx);
    (void)(e_msg);

    return malloc (size);
}
